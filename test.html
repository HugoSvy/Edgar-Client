<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recherche de Plante</title>
</head>
<body>
    <h1>Recherche de Plante</h1>
    <input type="text" id="plantName" placeholder="Nom de la plante">
    <button onclick="searchPlant()">Rechercher</button>
    <div id="results"></div>

    <script>
        async function searchPlant() {
            const query = document.getElementById("plantName").value;
            if (!query) {
                alert("Veuillez entrer un nom de plante.");
                return;
            }

            const apiKey = "2crFJXLwS3RXr0ULvGOpRNwI6Dl1i90zlRIQvcjsu0vGxFac4A";
            const searchUrl = `https://plant.id/api/v3/kb/plants/name_search?q=${encodeURIComponent(query)}`;
            const headers = {
                "Api-Key": apiKey,
                "Content-Type": "application/json"
            };

            try {
                const searchResponse = await fetch(searchUrl, { method: "GET", headers });
                const searchData = await searchResponse.json();
                
                const resultsDiv = document.getElementById("results");
                resultsDiv.innerHTML = ""; // Nettoyage des résultats précédents
                
                if (!searchData.entities || searchData.entities.length === 0) {
                    resultsDiv.innerHTML = "<p>Aucune plante trouvée.</p>";
                    return;
                }

                // Récupération des access-tokens
                const plantDetailsPromises = searchData.entities.map(async entity => {
                    const detailsUrl = `https://plant.id/api/v3/kb/plants/${entity.access_token}?details=image&language=en`;
                    const detailsResponse = await fetch(detailsUrl, { method: "GET", headers });
                    return detailsResponse.json();
                });

                const plantDetails = await Promise.all(plantDetailsPromises);

                // Affichage des résultats
                plantDetails.forEach(plant => {
                    const plantDiv = document.createElement("div");
                    plantDiv.innerHTML = `
                        <h2>${plant.name}</h2>
                        <img src="${plant.image?.value || 'https://via.placeholder.com/150'}" alt="${plant.name}" width="200">
                    `;
                    resultsDiv.appendChild(plantDiv);
                });

            } catch (error) {
                console.error("Erreur:", error);
                document.getElementById("results").innerHTML = "<p>Une erreur s'est produite.</p>";
            }
        }
    </script>
</body>
</html>
